@{
    ViewData["Title"] = "Crear cuenta";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles{
  <style>
    .register-wrapper{
      min-height: calc(100vh - 120px);
      display: grid;
      place-items: center;
    }
    .register-card{
      max-width: 520px; width: 100%;
      backdrop-filter: blur(2px);
      border-radius: 1rem;
      border: 1px solid rgba(255,255,255,.12);
    }
    .register-card .form-label{ font-weight: 500; }
    .btn-register{ width:100%; }
    .password-hint{ font-size:.9rem; opacity:.9; }

    /* Compatible con alto contraste */
    body.a11y-contrast .register-card{
      background:#0f0f10 !important; border-color:#2a2e3a !important;
    }
    body.a11y-contrast .register-card .form-control{
      background:#111 !important; color:#fff !important; border-color:#777 !important;
    }
    body.a11y-contrast .register-card .form-control::placeholder{ color:#bbb; }
  </style>
}

<div class="register-wrapper container">
  <div class="register-card card shadow-sm p-4 bg-body">
    <h1 class="h3 mb-1 text-center">Crear cuenta</h1>
    <p class="text-center mb-4">Reg√≠strate con tu correo y una contrase√±a segura</p>

    <!-- Resumen de validaci√≥n (si backend lo usa) -->
    <div asp-validation-summary="ModelOnly" class="text-danger" role="alert" aria-live="polite"></div>

    <form asp-action="Register" asp-controller="Account" method="post" novalidate class="needs-validation">
      @Html.AntiForgeryToken()

      <!-- Nombre -->
      <div class="mb-3">
        <label for="Input_Name" class="form-label">Nombre</label>
        <input id="Input_Name" name="Name" type="text" class="form-control" required
               placeholder="Tu nombre" autocomplete="name" />
        <span class="text-danger" data-valmsg-for="Name" data-valmsg-replace="true"></span>
      </div>

      <!-- Correo -->
      <div class="mb-3">
        <label for="Input_Email" class="form-label">Correo electr√≥nico</label>
        <input id="Input_Email" name="Email" type="email" class="form-control" required
               placeholder="tucorreo@ejemplo.com" autocomplete="email" />
        <span class="text-danger" data-valmsg-for="Email" data-valmsg-replace="true"></span>
      </div>

      <!-- Contrase√±a -->
      <div class="mb-3">
        <label for="Input_Password" class="form-label">Contrase√±a</label>
        <div class="input-group">
          <input id="Input_Password" name="Password" type="password" class="form-control" required
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password" minlength="8" />
          <button type="button" class="btn btn-outline-secondary" aria-label="Mostrar u ocultar contrase√±a"
                  onclick="togglePwd('Input_Password', this)">üëÅ</button>
        </div>
        <div id="pwdHelp" class="form-text password-hint">
          M√≠nimo 8 caracteres. Usa may√∫sculas, min√∫sculas, n√∫mero y s√≠mbolo para mayor seguridad.
        </div>
        <span class="text-danger" data-valmsg-for="Password" data-valmsg-replace="true"></span>
      </div>

      <!-- Confirmar contrase√±a -->
      <div class="mb-3">
        <label for="Input_ConfirmPassword" class="form-label">Confirmar contrase√±a</label>
        <div class="input-group">
          <input id="Input_ConfirmPassword" name="ConfirmPassword" type="password" class="form-control" required
                 placeholder="Repite la contrase√±a" autocomplete="new-password" minlength="8" />
          <button type="button" class="btn btn-outline-secondary" aria-label="Mostrar u ocultar contrase√±a"
                  onclick="togglePwd('Input_ConfirmPassword', this)">üëÅ</button>
        </div>
        <span class="text-danger" data-valmsg-for="ConfirmPassword" data-valmsg-replace="true"></span>
      </div>

      <!-- T√©rminos -->
      <div class="mb-3 form-check">
        <input class="form-check-input" type="checkbox" id="AcceptTerms" name="AcceptTerms" required />
        <label class="form-check-label" for="AcceptTerms">
          Acepto los <a href="#" target="_blank" rel="noopener">t√©rminos y condiciones</a>
        </label>
        <div class="invalid-feedback">Debes aceptar los t√©rminos para continuar.</div>
      </div>

      <!-- Bot√≥n -->
      <button type="submit" class="btn btn-primary btn-register">Crear cuenta</button>

      <!-- Ya tengo cuenta -->
      <div class="text-center mt-3">
        <a class="link-secondary" asp-controller="Account" asp-action="Login">Ya tengo una cuenta</a>
      </div>
    </form>
  </div>
</div>

@section Scripts{
  <partial name="_ValidationScriptsPartial" />
  <script>
    // Mostrar / ocultar contrase√±a
    function togglePwd(id, btn){
      const el = document.getElementById(id);
      if(!el) return;
      const isPwd = el.type === 'password';
      el.type = isPwd ? 'text' : 'password';
      btn.setAttribute('aria-pressed', String(isPwd));
    }

    // Validaci√≥n HTML5 b√°sica (frente)
    (() => {
      const form = document.querySelector('form.needs-validation');
      if(!form) return;
      form.addEventListener('submit', (e) => {
        // Confirmaci√≥n de contrase√±a en front (adem√°s de lo que haga backend)
        const p = document.getElementById('Input_Password')?.value || '';
        const c = document.getElementById('Input_ConfirmPassword')?.value || '';
        if (p !== c) {
          e.preventDefault(); e.stopPropagation();
          alert('Las contrase√±as no coinciden.');
          return;
        }

        if (!form.checkValidity()) {
          e.preventDefault(); e.stopPropagation();
        }
        form.classList.add('was-validated');
      });
    })();
  </script>
}
