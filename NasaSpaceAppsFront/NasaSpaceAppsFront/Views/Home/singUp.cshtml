@{
    ViewData["Title"] = "Create Account";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
    <style>
        html, body { height: 100%; margin: 0; }
        body {
            background-color: #0B1226;
            background-image: linear-gradient(180deg, #0B1226, #1E3259);
        }
        .brand-logo { height: 48px; }
        .form-control-ux { background: rgba(255,255,255,.06); color: #fff; border: 1px solid rgba(255,255,255,.15); }
        .form-control-ux::placeholder { color: rgba(255,255,255,.6); }
        .link-ux { color: #cfd8ff; }
        .btn-ux { border-radius: 999px; }

        /* === SOLO para el SELECT de Sexo === */
        /* Texto y fondo del select (valor mostrado) */
        #sex.text-dark-select {
            color: #000 !important;
            background-color: #fff !important;
            border-color: #ced4da !important; /* borde claro tipo bootstrap */
        }
        /* Opciones dentro del desplegable */
        #sex.text-dark-select option { color: #000; background-color: #fff; }
        /* Placeholder (deshabilitado) un poco más gris */
        #sex.text-dark-select option[disabled] { color: #6c757d; }
    </style>
}

<section class="hero-bg d-flex align-items-start align-items-lg-center min-vh-100 py-4 py-lg-0">
  <div class="container position-relative">
    <!-- Encabezado -->
    <div class="row mb-4 mb-lg-5">
      <div class="col-12 d-flex align-items-center gap-3">
        <img src="~/img/Captura_de_pantalla_2025-10-04_130505-removebg-preview.png"
             alt="Logo"
             class="brand-logo img-fluid" />
        <h1 class="create-title m-0 text-white">Create Account</h1>
      </div>
    </div>

    <!-- Formulario -->
    <div class="row justify-content-start">
      <div class="col-12 col-md-10 col-lg-7 col-xl-6">
        <div class="card-body p-4">

          <!-- Nombre de usuario -->
          <div class="mb-3">
            <label for="username" class="form-label fw-normal text-white">Nombre de usuario</label>
            <input id="username" name="usuario" type="text"
                   class="form-control form-control-ux"
                   placeholder="tu_usuario" autocomplete="username" required>
          </div>

          <!-- Edad -->
          <div class="mb-3">
            <label for="age" class="form-label fw-normal text-white">Edad</label>
            <input id="age" name="edad" type="number" min="0" max="120"
                   class="form-control form-control-ux"
                   placeholder="18" required>
          </div>

          <!-- Sexo -->
          <div class="mb-3">
            <label for="sex" class="form-label fw-normal text-white">Sexo</label>
            <select id="sex" name="sexo" class="form-select form-control-ux text-dark-select" required>
              <option value="" disabled selected hidden>Selecciona una opción</option>
              <option value="Femenino">Femenino</option>
              <option value="Masculino">Masculino</option>
              <option value="Otro">Otro</option>
              <option value="Prefiero no decirlo">Prefiero no decirlo</option>
            </select>
          </div>

          <!-- Contraseña -->
          <div class="mb-4">
            <label for="password" class="form-label fw-normal text-white">Contraseña</label>
            <input id="password" name="contrasena" type="password"
                   class="form-control form-control-ux"
                   placeholder="••••••••" autocomplete="new-password" required>
          </div>

          <!-- Botón -->
          <div class="d-grid">
            <button type="button" id="submit" class="btn btn-dark btn-ux">Crear cuenta</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
      const loginurl = '@Url.Action("Login","Auth")';

      $("#submit").on("click", async function(){
        const usuario = $("#username").val().trim();
        const contrasena = $("#password").val().trim();
        const edadStr   = $("#age").val().trim();
        const sexo      = $("#sex").val();

        if (!usuario || !contrasena || !edadStr || !sexo) {
          alert("Completa todos los campos.");
          return;
        }

        const edad = parseInt(edadStr, 10);

        try {
          const res = await fetch("http://127.0.0.1:8000/registeruser", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "accept": "application/json"
            },
            body: JSON.stringify({
              usuario: usuario,
              contrasena: contrasena,
              edad: edad,
              sexo: sexo
            })
          });
          const json = await res.json();
          console.log(json);
          window.location = loginurl;
        } catch (e) {
          console.error(e);
          alert("No se pudo crear la cuenta.");
        }
      });
    </script>
}
