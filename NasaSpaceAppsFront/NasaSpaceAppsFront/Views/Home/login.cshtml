@{
    ViewData["Title"] = "Log In";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
    <style>
        html, body { height: 100%; margin: 0; }
        body {
            background-color: #0B1226;
            background-image: linear-gradient(180deg, #0B1226, #1E3259);
        }
        .brand-logo { height: 48px; }
        .form-control-ux {
            background: rgba(255,255,255,.06);
            color: #fff;
            border: 1px solid rgba(255,255,255,.15);
        }
        .form-control-ux::placeholder { color: rgba(255,255,255,.6); }
        .link-ux { color: #cfd8ff; }
        .btn-ux { border-radius: 999px; }
    </style>
}

<section class="hero-bg d-flex align-items-start align-items-lg-center min-vh-100 py-4 py-lg-0">
  <div class="container position-relative">
    
    <div class="row mb-4 mb-lg-5">
      <div class="col-12 d-flex align-items-center gap-3">
        <img src="~/img/Captura_de_pantalla_2025-10-04_130505-removebg-preview.png"
             alt="Logo"
             class="brand-logo img-fluid" />
        <h1 class="create-title m-0 text-white">Log In</h1>
      </div>
    </div>

    
    <div class="row justify-content-start">
      <div class="col-12 col-md-10 col-lg-7 col-xl-6">
        <div class="card-body p-4">

          
          <div class="mb-3">
            <label for="username" class="form-label fw-normal text-white">Username</label>
            <input id="username" name="usuario" type="text"
                   class="form-control form-control-ux"
                   placeholder="your_username" autocomplete="username" required>
          </div>

          
          <div class="mb-4">
            <label for="password" class="form-label fw-normal text-white">Password</label>
            <input id="password" name="contrasena" type="password"
                   class="form-control form-control-ux"
                   placeholder="••••••••" autocomplete="current-password" required>
          </div>

          
          <div class="d-grid mb-3">
            <button type="button" id="submit" class="btn btn-dark btn-ux">Sign in</button>
          </div>

          
          <div class="text-center">
            <a href='@Url.Action("singUp","Home")' class="text-decoration-underline link-ux">
              Don’t have an account? Create one
            </a>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
      const urlHome = '@Url.Action("Index","Home")';

      $("#submit").on("click", async function(){
        const usuario    = $("#username").val().trim();
        const contrasena = $("#password").val().trim();

        if (!usuario || !contrasena) {
          alert("Please fill in both fields.");
          return;
        }

        try {
          const res = await fetch("http://localhost:8000/verifyuser", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "accept": "application/json"
            },
            body: JSON.stringify({
              usuario: usuario,
              contrasena: contrasena
            })
          });

          const data = await res.json();

          if (res.ok && data.message === "Aqui se dirige al menu principal") {
            // Redirige al home con el id que devuelve tu API
            window.location.href = urlHome + (data.id ? ("?id=" + data.id) : "");
          } else {
            alert(data.message || "Invalid credentials.");
          }
        } catch (e) {
          console.error(e);
          alert("Server error. Please try again.");
        }
      });
    </script>
}
