@{
    ViewData["Title"] = "Welcome | Space BioLab";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            background-color: #0B1226;
            background-image: linear-gradient(180deg, #0B1226, #1E3259);
        }

    </style>


}
  <!-- Fondo principal -->
  <div class="background">
    <div class="overlay"></div>
    <img src="assets/img/pexels-pixabay-41953-removebg-preview.png" class="planet-img" alt="">
  </div>

  <!-- Barra de navegación -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid px-5">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="~/helio_logo.png" alt="Logo" width="60" class="me-2">
        Helio lab
      </a>

      <div class="d-flex">
        <!-- IDs + href de respaldo -->
            @if(ViewBag.id == null)
            {
                <a id="btnLoginNav" class="btn  btn-outline-light rounded-pill mx-1" asp-action="login">Login</a>
                <a id="btnRegisterNav" class="btn  btn-outline-light rounded-pill mx-1" asp-action="singUp">Sign Up</a>

            }
            else
            {
                <a id="btnHistorial" class="btn  btn-outline-light rounded-pill mx-1" asp-route-id=@ViewBag.id asp-action="Historial">Historial</a>
                <a id="btnSignOut" class="btn  btn-outline-light rounded-pill mx-1" asp-action="Index">Signout</a>

            }
            <button class="btn btn-outline-light"
                data-bs-toggle="offcanvas" data-bs-target="#ajustesPanel"
                aria-controls="ajustesPanel">Ajustes</button>

        </div>
    </div>
  </nav>



  <!-- Contenido principal -->
<section class="d-flex flex-column justify-content-center align-items-center text-center text-white ">
    <h1 class="display-1 fw-bold mb-3">WELCOME</h1>
    <p class="lead mb-5">“From cells to stars — discover how life adapts beyond Earth.”</p>

    <nav class="navbar bg-transparent ">
        <div class="container-fluid d-flex flex-nowrap align-items-center gap-2 w-100">
            <form method="get" id="formulario_enviar" asp-action="busc" class=" d-flex flex-nowrap align-items-center gap-2 w-100">
             <input class="form-control me-2 col-lg-12 text-white bg-black" type="search" placeholder="Search" id="search" name="search" aria-label="Search">
            <button class="btn btn-outline-success" id="searchButton"type="submit">Search</button>

            </form>
        </div>
    </nav>
    <ul class="list-group bg-transparent" id="busqueda">
    </ul>

    <img src="/fondo.png" alt="" class="hero-bottom-img w-100">


</section>

<div class="offcanvas offcanvas-end" tabindex="-1" id="ajustesPanel" aria-labelledby="ajustesTitle">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="ajustesTitle">Configuración de accesibilidad</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body">
        <div class="accordion" id="ajustesAccordion">

            <div class="accordion-item">
                <h2 class="accordion-header" id="hdrVision">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#colVision" aria-expanded="true" aria-controls="colVision">
                        Visión
                    </button>
                </h2>
                <div id="colVision" class="accordion-collapse collapse show" data-bs-parent="#ajustesAccordion">
                    <div class="accordion-body">
                        <div class="form-check mb-2">
                            <input class="form-check-input Ciego" type="checkbox" id="Ciego">
                            <label class="form-check-label" for="highContrast">Ciego</label>
                        </div>
                        
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="hdrDaltonismo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#colDaltonismo" aria-expanded="false" aria-controls="colDaltonismo">
                        Daltonismo
                    </button>
                </h2>
                <div id="colDaltonismo" class="accordion-collapse collapse" data-bs-parent="#ajustesAccordion">
                    <div class="accordion-body">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cbMode" value="none" id="cbNone" checked>
                            <label class="form-check-label" for="cbNone">Normal</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cbMode" value="protanopia" id="cbPro">
                            <label class="form-check-label" for="cbPro">Protanopia</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cbMode" value="deuteranopia" id="cbDeu">
                            <label class="form-check-label" for="cbDeu">Deuteranopia</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cbMode" value="tritanopia" id="cbTri">
                            <label class="form-check-label" for="cbTri">Tritanopia</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="cbMode" value="mono" id="cbMono">
                            <label class="form-check-label" for="cbMono">Monocromático</label>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <hr class="my-3">
        <div class="d-flex justify-content-end gap-2">
            <button id="a11yReset" class="btn btn-light">Restablecer</button>
            <button id="a11ySave" class="btn btn-primary" data-bs-dismiss="offcanvas">Guardar</button>
        </div>
    </div>
</div>



@section Scripts{
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.js"></script>

    <!-- Controlador -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>





        $('#search').on('input change',async function (){
            let res = await fetch("http://127.0.0.1:8000/enterdata", {
                method: "POST",
                headers: {
                  'Content-Type': 'application/json',
                  'accept' : 'application/json'// Indica que estás enviando JSON
                  },
                 body:JSON.stringify({
                     palabra:$("#search").val()
                 })
            });
            let json = await res.json();
            const et = document.getElementById("busqueda");
            let plantilla = '';
            json.resultados.forEach(function(data){
                plantilla += '<li class="list-group-item bg-transparent text-white"><button class=" btn btn-outline-light w-100 text-white buttonResult py-2" data-title="' +data + '" type="button">' + data + '</button></li>'
            });
            et.innerHTML = plantilla;

        });

        $(".buttonResult").on("click" , async function(){
            console.log("hola")
            let data = $(this).data("title");
            console.log(data);
            $("#search").val(data);
        });
         $('#busqueda').on('click', '.buttonResult', function () {
            const title = $(this).data('title');
            $('#search').val(title); // opcional: dispara nueva búsqueda
        
        });

            $('#busqueda').on('mouseenter', '.buttonResult', function () {
          const title = $(this).data('title');
          console.log($('#Ciego').prop('checked'));
          if($('.Ciego').prop('checked')){
           if (!('speechSynthesis' in window) || !title) return;

          speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(title);
          u.lang = 'es-MX'; u.rate = 1; u.pitch = 1;
          speechSynthesis.speak(u);
          }

          
        });
        
       
    </script>
    @if (ViewBag.id != null)
    {
        <script>
                $('#formulario_enviar').on('submit' , async function(e){
                    e.preventDefault();
                    const form = this;
                let res = await fetch('http://127.0.0.1:8000/insertarHistorial' , {
                    method: "POST",
                    headers: {
                      'Content-Type': 'application/json',
                      'accept' : 'application/json'// Indica que estás enviando JSON
                      },
                    body: JSON.stringify({
                        id_usuario: @ViewBag.id,
                        titulo: $('#search').val(),
                        url: "nsql"
                    })
                });
                form.submit();

            });
            
        </script>

    }
    @if(ViewBag.id == null)
    {
        <script>
            $('#formulario_enviar').on('submit' , async function(e){
                 e.preventDefault();
                 const form = this;
               
                form.submit();
            });


        </script>
    }
}

